\chapter{Network architectures} % Main appendix title

\label{AppendixB} % For referencing this appendix elsewhere, use \ref{AppendixX}

\section{NVIDIA baseline architecture}
\label{NVIDIA_baseline}
\label{arc:nvidia_baseline}

This is the starting point after the work of \cite{bojarski2016end}

\begin{verbatim}
>>> import models
>>> mymodel = models.nvidia_baseline(1)
>>> models.show_model_summary(mymodel)
Model: "model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
img_in (InputLayer)          [(None, 66, 200, 3)]      0         
_________________________________________________________________
lambda (Lambda)              (None, 66, 200, 3)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 31, 98, 24)        1824      
_________________________________________________________________
dropout (Dropout)            (None, 31, 98, 24)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 14, 47, 36)        21636     
_________________________________________________________________
dropout_1 (Dropout)          (None, 14, 47, 36)        0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 5, 22, 48)         43248     
_________________________________________________________________
dropout_2 (Dropout)          (None, 5, 22, 48)         0         
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 3, 20, 64)         27712     
_________________________________________________________________
dropout_3 (Dropout)          (None, 3, 20, 64)         0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 1, 18, 64)         36928     
_________________________________________________________________
dropout_4 (Dropout)          (None, 1, 18, 64)         0         
_________________________________________________________________
flattened (Flatten)          (None, 1152)              0         
_________________________________________________________________
dense_1 (Dense)              (None, 1164)              1342092   
_________________________________________________________________
dropout_5 (Dropout)          (None, 1164)              0         
_________________________________________________________________
dense_2 (Dense)              (None, 100)               116500    
_________________________________________________________________
dropout_6 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_3 (Dense)              (None, 50)                5050      
_________________________________________________________________
dropout_7 (Dropout)          (None, 50)                0         
_________________________________________________________________
dense_4 (Dense)              (None, 10)                510       
_________________________________________________________________
dropout_8 (Dropout)          (None, 10)                0         
_________________________________________________________________
steering (Dense)             (None, 1)                 11        
=================================================================
Total params: 1,595,511
Trainable params: 1,595,511
Non-trainable params: 0
_________________________________________________________________
[(None, 66, 200, 3)]
(None, 66, 200, 3)
(None, 31, 98, 24)
(None, 31, 98, 24)
(None, 14, 47, 36)
(None, 14, 47, 36)
(None, 5, 22, 48)
(None, 5, 22, 48)
(None, 3, 20, 64)
(None, 3, 20, 64)
(None, 1, 18, 64)
(None, 1, 18, 64)
(None, 1152)
(None, 1164)
(None, 1164)
(None, 100)
(None, 100)
(None, 50)
(None, 50)
(None, 10)
(None, 10)
(None, 1)
\end{verbatim}

\section{NVIDIA1 architecture}
\label{arc:nvidia1}
The network architecture is as shown, with a total of 817,028 trainable parameters. The design is exactly as used by \cite{SDSandboxSim}.
\begin{verbatim}
>>> import models
>>> mymodel = models.nvidia_model1(2)
>>> models.show_model_summary(mymodel)
Model: "model_3"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
img_in (InputLayer)          [(None, 120, 160, 3)]     0         
_________________________________________________________________
lambda_3 (Lambda)            (None, 120, 160, 3)       0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 58, 78, 24)        1824      
_________________________________________________________________
dropout_15 (Dropout)         (None, 58, 78, 24)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 27, 37, 32)        19232     
_________________________________________________________________
dropout_16 (Dropout)         (None, 27, 37, 32)        0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 12, 17, 64)        51264     
_________________________________________________________________
dropout_17 (Dropout)         (None, 12, 17, 64)        0         
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 10, 15, 64)        36928     
_________________________________________________________________
dropout_18 (Dropout)         (None, 10, 15, 64)        0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 8, 13, 64)         36928     
_________________________________________________________________
dropout_19 (Dropout)         (None, 8, 13, 64)         0         
_________________________________________________________________
flattened (Flatten)          (None, 6656)              0         
_________________________________________________________________
dense_6 (Dense)              (None, 100)               665700    
_________________________________________________________________
dense_7 (Dense)              (None, 50)                5050      
_________________________________________________________________
steering_throttle (Dense)    (None, 2)                 102       
=================================================================
Total params: 817,028
Trainable params: 817,028
Non-trainable params: 0
_________________________________________________________________
[(None, 120, 160, 3)]
(None, 120, 160, 3)
(None, 58, 78, 24)
(None, 58, 78, 24)
(None, 27, 37, 32)
(None, 27, 37, 32)
(None, 12, 17, 64)
(None, 12, 17, 64)
(None, 10, 15, 64)
(None, 10, 15, 64)
(None, 8, 13, 64)
(None, 8, 13, 64)
(None, 6656)
(None, 100)
(None, 50)
(None, 2)    
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% NVIDIA2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{NVIDIA2 Architecture}
\label{arc:nvidia2}
\begin{verbatim}
>>> import models
>>> mymodel = models.nvidia_model2(2)
>>> models.show_model_summary(mymodel)
Model: "model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
img_in (InputLayer)          [(None, 66, 200, 3)]      0         
_________________________________________________________________
lambda (Lambda)              (None, 66, 200, 3)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 31, 98, 24)        1824      
_________________________________________________________________
dropout (Dropout)            (None, 31, 98, 24)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 14, 47, 32)        19232     
_________________________________________________________________
dropout_1 (Dropout)          (None, 14, 47, 32)        0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 5, 22, 48)         38448     
_________________________________________________________________
dropout_2 (Dropout)          (None, 5, 22, 48)         0         
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 3, 20, 64)         27712     
_________________________________________________________________
dropout_3 (Dropout)          (None, 3, 20, 64)         0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 1, 18, 64)         36928     
_________________________________________________________________
dropout_4 (Dropout)          (None, 1, 18, 64)         0         
_________________________________________________________________
flattened (Flatten)          (None, 1152)              0         
_________________________________________________________________
dense (Dense)                (None, 100)               115300    
_________________________________________________________________
dense_1 (Dense)              (None, 50)                5050      
_________________________________________________________________
dense_2 (Dense)              (None, 10)                510       
_________________________________________________________________
steering_throttle (Dense)    (None, 2)                 22        
=================================================================
Total params: 245,026    
Trainable params: 245,026
Non-trainable params: 0
_________________________________________________________________
[(None, 66, 200, 3)]
(None, 66, 200, 3)
(None, 31, 98, 24)
(None, 31, 98, 24)
(None, 14, 47, 32)
(None, 14, 47, 32)
(None, 5, 22, 48)
(None, 5, 22, 48)
(None, 3, 20, 64)
(None, 3, 20, 64)
(None, 1, 18, 64)
(None, 1, 18, 64)
(None, 1152)
(None, 100)
(None, 50)
(None, 10)
(None, 2)

\end{verbatim}



\section{Alexnet}

\begin{verbatim}
models.show_model_summary(model)
Model: "model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
img_in (InputLayer)          [(None, 224, 224, 3)]     0         
_________________________________________________________________
lambda (Lambda)              (None, 224, 224, 3)       0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 54, 54, 48)        17472     
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 25, 25, 128)       153728    
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 12, 12, 192)       221376    
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 10, 10, 192)       331968    
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 4, 4, 192)         0         
_________________________________________________________________
dropout (Dropout)            (None, 4, 4, 192)         0         
_________________________________________________________________
flattened (Flatten)          (None, 3072)              0         
_________________________________________________________________
dense (Dense)                (None, 2048)              6293504   
_________________________________________________________________
dense_1 (Dense)              (None, 2048)              4196352   
_________________________________________________________________
steering_throttle (Dense)    (None, 2)                 4098      
=================================================================
Total params: 11,218,498
Trainable params: 11,218,498
Non-trainable params: 0
_________________________________________________________________
[(None, 224, 224, 3)]
(None, 224, 224, 3)
(None, 54, 54, 48)
(None, 25, 25, 128)
(None, 12, 12, 192)
(None, 10, 10, 192)
(None, 4, 4, 192)
(None, 4, 4, 192)
(None, 3072)
(None, 2048)
(None, 2048)
(None, 2)
\end{verbatim}

\section{Training and testing networks}
A network is trained by running the script:
\begin{verbatim}
$ python --model=nvidia1
    --outdir=../trained_models
    --epochs=1
    --inputs=../dataset/unity/roboleague/log/*.jpg
    --aug=false
    --crop=false    
\end{verbatim}
This will generate a model, saved in the .h5 format, a python dictionary object with training and testing accuracy and loss values, and an accuracy and loss plot with information additional labels to help identify the trained model. Finally, a log file is saved to disk containing model name, training time and last recorded loss and accuracy values for training and testing datasets.

run experiment on vanilla code (no augmentation)
Record cash crash and deviation from actual to predicted steering angles.

